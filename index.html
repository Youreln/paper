<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°çº¸æ¡å¢™ Â· Paper Wall</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Noto Sans SC', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .bg-animation::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 20% 80%, rgba(255, 223, 112, 0.08) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(255, 223, 112, 0.05) 0%, transparent 50%),
                        radial-gradient(circle at 40% 40%, rgba(255, 223, 112, 0.03) 0%, transparent 40%);
            animation: bgFlow 20s ease-in-out infinite;
        }

        @keyframes bgFlow {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(30px, -30px) rotate(120deg); }
            66% { transform: translate(-20px, 20px) rotate(240deg); }
        }

        .page-enter {
            animation: pageEnter 0.8s ease-out forwards;
        }

        @keyframes pageEnter {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .paper-card {
            background: linear-gradient(145deg, #fff9e6, #fff5d6);
            box-shadow: 0 10px 40px rgba(255, 223, 112, 0.2),
                        0 5px 20px rgba(0, 0, 0, 0.15);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            animation: cardFloat 4s ease-in-out infinite;
        }

        .paper-card:hover {
            transform: translateY(-8px) rotate(1deg);
            box-shadow: 0 20px 50px rgba(255, 223, 112, 0.3),
                        0 10px 30px rgba(0, 0, 0, 0.2);
        }

        @keyframes cardFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .paper-card:nth-child(odd) {
            animation-delay: -2s;
        }

        .paper-card:nth-child(3n) {
            transform: rotate(-1deg);
        }

        .paper-card:nth-child(3n):hover {
            transform: translateY(-8px) rotate(-1deg);
        }

        .write-btn {
            background: linear-gradient(135deg, #ffdf70 0%, #ffd43b 100%);
            box-shadow: 0 8px 25px rgba(255, 223, 112, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            animation: breathe 3s ease-in-out infinite;
        }

        @keyframes breathe {
            0%, 100% { box-shadow: 0 8px 25px rgba(255, 223, 112, 0.4); }
            50% { box-shadow: 0 8px 40px rgba(255, 223, 112, 0.7); }
        }

        .write-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 35px rgba(255, 223, 112, 0.6);
            animation: none;
        }

        .write-btn:active {
            transform: scale(0.95);
        }

        .github-btn {
            background: linear-gradient(135deg, #24292e 0%, #1a1e22 100%);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .github-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }

        .modal-overlay {
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            animation: modalEnter 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes modalEnter {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .success-icon {
            animation: successPop 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes successPop {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .particle {
            position: fixed;
            width: 6px;
            height: 6px;
            background: #ffdf70;
            border-radius: 50%;
            pointer-events: none;
            z-index: 9999;
            animation: particleFade 1s ease-out forwards;
        }

        @keyframes particleFade {
            0% {
                opacity: 1;
                transform: translate(0, 0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(var(--tx), var(--ty)) scale(0);
            }
        }

        .loading-spinner {
            border: 3px solid rgba(255, 223, 112, 0.3);
            border-top: 3px solid #ffdf70;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .title-gradient {
            background: linear-gradient(135deg, #ffdf70 0%, #ffd43b 50%, #ffdf70 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            background-size: 200% auto;
            animation: titleShine 3s linear infinite;
        }

        @keyframes titleShine {
            to { background-position: 200% center; }
        }

        .paper-input {
            background: linear-gradient(145deg, #fff9e6, #fff5d6);
            box-shadow: 0 20px 60px rgba(255, 223, 112, 0.3),
                        0 10px 30px rgba(0, 0, 0, 0.2),
                        inset 0 1px 0 rgba(255, 255, 255, 0.8);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .paper-input:focus-within {
            box-shadow: 0 25px 70px rgba(255, 223, 112, 0.4),
                        0 15px 40px rgba(0, 0, 0, 0.25),
                        inset 0 1px 0 rgba(255, 255, 255, 0.8);
        }

        .paper-input textarea {
            background: transparent;
            resize: none;
        }

        .publish-btn {
            background: linear-gradient(135deg, #ffdf70 0%, #ffd43b 100%);
            box-shadow: 0 8px 25px rgba(255, 223, 112, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .publish-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255, 223, 112, 0.5);
        }

        .publish-btn:active {
            transform: translateY(0);
            box-shadow: 0 4px 15px rgba(255, 223, 112, 0.3);
        }

        .empty-state {
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .card-enter {
            animation: cardEnter 0.5s ease-out forwards;
        }

        @keyframes cardEnter {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .debug-panel {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 223, 112, 0.2);
            max-height: 200px;
            overflow-y: auto;
        }

        .debug-panel::-webkit-scrollbar {
            width: 6px;
        }

        .debug-panel::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
        }

        .debug-panel::-webkit-scrollbar-thumb {
            background: rgba(255, 223, 112, 0.3);
            border-radius: 3px;
        }

        .log-item {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            animation: logEnter 0.3s ease-out;
        }

        @keyframes logEnter {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
    </style>
</head>
<body class="min-h-screen relative">
    <div class="bg-animation"></div>

    <div class="relative z-10 min-h-screen flex flex-col">
        <header class="page-enter text-center py-8 md:py-12 px-4">
            <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold title-gradient mb-2">
                å°çº¸æ¡å¢™
            </h1>
            <p class="text-gray-400 text-base md:text-lg font-light tracking-wider">
                Paper Wall
            </p>
            <div class="mt-4 flex items-center justify-center gap-4">
                <span id="paperCount" class="text-yellow-400 text-lg font-medium">
                    åŠ è½½ä¸­...
                </span>
                <a 
                    href="https://github.com/Youreln/paper/issues" 
                    target="_blank"
                    class="text-gray-500 hover:text-white text-sm transition-colors flex items-center gap-1"
                >
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    ç®¡ç†
                </a>
            </div>
        </header>

        <div id="debugPanel" class="fixed top-4 right-4 w-80 z-50 hidden">
            <div class="debug-panel rounded-xl p-4">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="text-white font-semibold text-sm flex items-center gap-2">
                        <svg class="w-4 h-4 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                        </svg>
                        è°ƒè¯•æ—¥å¿—
                    </h3>
                    <div class="flex gap-2">
                        <button id="clearLogs" class="text-gray-400 hover:text-white text-xs transition-colors">
                            æ¸…ç©º
                        </button>
                        <button id="toggleDebug" class="text-gray-400 hover:text-white text-xs transition-colors">
                            éšè—
                        </button>
                    </div>
                </div>
                <div id="logContainer" class="text-xs space-y-1">
                </div>
            </div>
        </div>

        <button 
            id="showDebugBtn"
            class="fixed top-4 right-4 w-10 h-10 bg-black/50 hover:bg-black/70 rounded-lg flex items-center justify-center text-white z-40 transition-all"
            title="æ˜¾ç¤ºè°ƒè¯•é¢æ¿"
        >
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
            </svg>
        </button>

        <main class="flex-1 px-4 pb-24">
            <div id="loadingState" class="flex flex-col items-center justify-center py-20">
                <div class="loading-spinner mb-4"></div>
                <p class="text-gray-400">åŠ è½½å°çº¸æ¡ä¸­...</p>
            </div>

            <div id="emptyState" class="hidden empty-state flex flex-col items-center justify-center py-20">
                <div class="w-24 h-24 mb-6 opacity-50">
                    <svg viewBox="0 0 24 24" fill="none" stroke="#ffdf70" stroke-width="1.5">
                        <path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"/>
                        <path d="M12 8v8M8 12h8"/>
                    </svg>
                </div>
                <p class="text-gray-400 text-lg mb-2">è¿˜æ²¡æœ‰å°çº¸æ¡</p>
                <p class="text-gray-500 text-sm">ç‚¹å‡»å³ä¸‹è§’æŒ‰é’®å†™ä¸‹ç¬¬ä¸€å¼ å°çº¸æ¡å§</p>
            </div>

            <div id="papersGrid" class="hidden max-w-6xl mx-auto">
                <div id="papersContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                </div>
            </div>
        </main>
    </div>

    <button 
        id="writeBtn"
        class="write-btn fixed bottom-6 right-6 w-16 h-16 md:w-20 md:h-20 rounded-full flex items-center justify-center z-40"
        title="å†™å°çº¸æ¡"
    >
        <svg class="w-8 h-8 text-gray-800" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
        </svg>
    </button>

    <a 
        href="https://github.com/Youreln/paper" 
        target="_blank"
        class="github-btn fixed bottom-6 left-6 w-14 h-14 md:w-16 md:h-16 rounded-full flex items-center justify-center text-white z-40"
        title="å¼€æºé¡¹ç›®"
    >
        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
        </svg>
    </a>

    <button 
        id="settingsBtn"
        class="fixed top-4 left-4 w-10 h-10 bg-black/50 hover:bg-black/70 rounded-lg flex items-center justify-center text-white z-40 transition-all"
        title="è®¾ç½® Token"
    >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
        </svg>
    </button>

    <div id="tokenModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 hidden">
        <div class="modal-content bg-gradient-to-br from-slate-800 to-slate-900 rounded-3xl p-6 md:p-8 max-w-lg w-full mx-4 shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-white">è®¾ç½® Token</h2>
                <button id="closeTokenModal" class="text-gray-400 hover:text-white transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <div class="mb-4">
                <label class="block text-gray-300 text-sm font-medium mb-2">
                    GitHub Token
                </label>
                <div class="relative">
                    <input 
                        id="tokenInput" 
                        type="password"
                        class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-gray-500 outline-none focus:border-yellow-400 transition-colors"
                        placeholder="è¯·è¾“å…¥ GitHub Token"
                    >
                    <button id="toggleTokenVisibility" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white">
                        <svg id="eyeIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <div class="bg-yellow-500/10 border border-yellow-500/30 rounded-xl p-4 mb-4">
                <p class="text-yellow-400 text-sm">
                    <strong>å¦‚ä½•è·å– Tokenï¼Ÿ</strong><br>
                    1. è®¿é—® <a href="https://github.com/settings/tokens" target="_blank" class="underline">GitHub Tokens</a><br>
                    2. ç‚¹å‡» "Generate new token (classic)"<br>
                    3. å‹¾é€‰ <code class="bg-black/30 px-1 rounded">repo</code> æƒé™<br>
                    4. ç”Ÿæˆåå¤åˆ¶ Token ç²˜è´´åˆ°ä¸Šæ–¹è¾“å…¥æ¡†
                </p>
            </div>

            <div class="bg-red-500/10 border border-red-500/30 rounded-xl p-4 mb-4">
                <p class="text-red-400 text-sm">
                    <strong>æ²¡æœ‰ Tokenï¼Ÿ</strong><br>
                    è¯·è”ç³»ä½œè€…è·å– Tokenï¼Œæˆ–è€…<br>
                    <a href="https://github.com/Youreln/paper/issues" target="_blank" class="underline font-semibold">ç‚¹å‡»è¿™é‡Œç•™è¨€è”ç³»ä½œè€…</a>
                </p>
            </div>

            <div class="bg-blue-500/10 border border-blue-500/30 rounded-xl p-4 mb-6">
                <p class="text-blue-400 text-sm">
                    <strong>æç¤ºï¼š</strong> Token ä»…ä¿å­˜åœ¨æ‚¨çš„æµè§ˆå™¨æœ¬åœ°ï¼Œä¸ä¼šå‘é€åˆ°ä»»ä½•æœåŠ¡å™¨ã€‚
                </p>
            </div>

            <button 
                id="saveTokenBtn"
                class="publish-btn w-full py-4 rounded-2xl text-gray-800 font-semibold text-lg flex items-center justify-center gap-2"
            >
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                ä¿å­˜ Token
            </button>

            <div id="tokenIframe" class="hidden mt-3 rounded-xl overflow-hidden border border-white/20">
                <iframe 
                    src="https://yourelnapi.rth1.xyz/copy.html" 
                    class="w-full h-64"
                    frameborder="0"
                ></iframe>
            </div>

            <div class="mt-3 flex gap-2">
                <button 
                    id="fetchTokenBtn"
                    class="flex-1 py-3 bg-blue-600 hover:bg-blue-700 rounded-xl text-white font-medium transition-colors flex items-center justify-center gap-2"
                >
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                    </svg>
                    è·å– Token
                </button>
                <a 
                    href="https://yourelnapi.rth1.xyz/copy.html" 
                    target="_blank"
                    class="flex-1 py-3 bg-gray-600 hover:bg-gray-700 rounded-xl text-white font-medium transition-colors flex items-center justify-center gap-2"
                >
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                    </svg>
                    æ‰“å¼€é¡µé¢
                </a>
            </div>
        </div>
    </div>

    <div id="shareModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 hidden">
        <div class="modal-content bg-gradient-to-br from-slate-800 to-slate-900 rounded-3xl p-6 md:p-8 max-w-lg w-full mx-4 shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-white">åˆ†äº«å°çº¸æ¡</h2>
                <button id="closeShareModal" class="text-gray-400 hover:text-white transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <div id="sharePreview" class="bg-white rounded-2xl p-4 mb-4">
            </div>
            
            <div class="flex gap-2">
                <button 
                    id="downloadShareBtn"
                    class="flex-1 py-3 bg-green-600 hover:bg-green-700 rounded-xl text-white font-medium transition-colors flex items-center justify-center gap-2"
                >
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                    </svg>
                    ä¸‹è½½å›¾ç‰‡
                </button>
                <button 
                    id="closeShareBtn"
                    class="flex-1 py-3 bg-gray-600 hover:bg-gray-700 rounded-xl text-white font-medium transition-colors"
                >
                    å…³é—­
                </button>
            </div>
        </div>
    </div>

    <div id="writeModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 hidden">
        <div class="modal-content bg-gradient-to-br from-slate-800 to-slate-900 rounded-3xl p-6 md:p-8 max-w-lg w-full mx-4 shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-white">å†™å°çº¸æ¡</h2>
                <button id="closeWriteModal" class="text-gray-400 hover:text-white transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <div class="mb-4">
                <label class="block text-gray-300 text-sm font-medium mb-2">
                    ä½ çš„æ˜µç§°
                </label>
                <input 
                    id="paperAuthor" 
                    type="text"
                    class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-gray-500 outline-none focus:border-yellow-400 transition-colors"
                    placeholder="åŒ¿å"
                    maxlength="50"
                >
            </div>
            
            <div class="paper-input rounded-2xl p-5 mb-4">
                <textarea 
                    id="paperContent" 
                    class="w-full h-32 md:h-40 text-gray-800 text-base leading-relaxed outline-none placeholder-gray-400"
                    placeholder="å†™ä¸‹ä½ æƒ³è¯´çš„è¯..."
                    maxlength="500"
                ></textarea>
            </div>
            
            <div class="mb-4">
                <label class="block text-gray-300 text-sm font-medium mb-2">
                    ä¸Šä¼ å›¾ç‰‡ï¼ˆå¯é€‰ï¼‰
                </label>
                <div class="flex gap-2">
                    <label class="flex-1 cursor-pointer">
                        <input 
                            id="paperImage" 
                            type="file" 
                            accept="image/*" 
                            class="hidden"
                        >
                        <div class="w-full py-3 bg-white/10 border border-white/20 rounded-xl text-gray-300 hover:bg-white/20 transition-colors flex items-center justify-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                            é€‰æ‹©å›¾ç‰‡
                        </div>
                    </label>
                    <button id="clearImageBtn" class="hidden px-3 bg-red-500/20 hover:bg-red-500/40 text-red-400 rounded-xl transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                <div id="imagePreview" class="mt-2 hidden">
                    <img id="previewImg" class="w-full h-32 object-cover rounded-xl" src="" alt="é¢„è§ˆ">
                </div>
            </div>
            
            <div class="flex justify-between items-center mb-6">
                <span id="charCount" class="text-gray-400 text-sm">0/500</span>
                <span class="text-gray-500 text-xs">æ”¯æŒ Markdown æ ¼å¼</span>
            </div>

            <div class="flex gap-2">
                <button 
                    id="publishBtn"
                    class="flex-1 publish-btn py-4 rounded-2xl text-gray-800 font-semibold text-lg flex items-center justify-center gap-2"
                >
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                    </svg>
                    å‘å¸ƒå°çº¸æ¡
                </button>
                <button 
                    id="shareBtn"
                    class="px-4 py-4 bg-green-600 hover:bg-green-700 rounded-2xl text-white font-medium transition-colors flex items-center justify-center gap-2"
                    title="ç”Ÿæˆåˆ†äº«å›¾ç‰‡"
                >
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <div id="successModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 hidden">
        <div class="modal-content bg-white rounded-3xl p-8 max-w-sm mx-4 text-center">
            <div class="success-icon w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-10 h-10 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                </svg>
            </div>
            <h3 class="text-2xl font-bold text-gray-800 mb-2">å‘å¸ƒæˆåŠŸ!</h3>
            <p class="text-gray-600 mb-6">ä½ çš„å°çº¸æ¡å·²ç»è´´åœ¨å¢™ä¸Šäº†</p>
            <button 
                id="closeSuccessModal"
                class="publish-btn px-8 py-3 rounded-full text-gray-800 font-semibold"
            >
                å¤ªæ£’äº†
            </button>
        </div>
    </div>

    <div id="errorModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 hidden">
        <div class="modal-content bg-white rounded-3xl p-8 max-w-sm mx-4 text-center">
            <div class="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-10 h-10 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </div>
            <h3 class="text-2xl font-bold text-gray-800 mb-2">å‘å¸ƒå¤±è´¥</h3>
            <p id="errorMessage" class="text-gray-600 mb-6">è¯·ç¨åé‡è¯•</p>
            <button 
                id="closeErrorModal"
                class="publish-btn px-8 py-3 rounded-full text-gray-800 font-semibold"
            >
                æˆ‘çŸ¥é“äº†
            </button>
        </div>
    </div>

    <script>
        const CONFIG = {
            owner: 'Youreln',
            repo: 'paper'
        };

        let token = localStorage.getItem('paper_wall_token') || '';
        let hasShownTokenPrompt = false;
        
        function getUsername() {
            return localStorage.getItem('paper_wall_username') || 'åŒ¿å';
        }
        
        function setUsername(name) {
            localStorage.setItem('paper_wall_username', name);
        }

        function getToken() {
            return token;
        }

        function setToken(newToken) {
            token = newToken;
            localStorage.setItem('paper_wall_token', newToken);
        }

        function checkToken() {
            if (!token && !hasShownTokenPrompt) {
                hasShownTokenPrompt = true;
                setTimeout(() => {
                    tokenModal.classList.remove('hidden');
                    log('è¯·å…ˆè®¾ç½® GitHub Token', 'warn');
                }, 1000);
                return false;
            }
            return !!token;
        }

        const loadingState = document.getElementById('loadingState');
        const emptyState = document.getElementById('emptyState');
        const papersGrid = document.getElementById('papersGrid');
        const papersContainer = document.getElementById('papersContainer');
        const paperCount = document.getElementById('paperCount');
        const writeBtn = document.getElementById('writeBtn');
        const writeModal = document.getElementById('writeModal');
        const closeWriteModal = document.getElementById('closeWriteModal');
        const paperAuthor = document.getElementById('paperAuthor');
        const paperContent = document.getElementById('paperContent');
        const paperImage = document.getElementById('paperImage');
        const imagePreview = document.getElementById('imagePreview');
        const previewImg = document.getElementById('previewImg');
        const clearImageBtn = document.getElementById('clearImageBtn');
        const charCount = document.getElementById('charCount');
        const publishBtn = document.getElementById('publishBtn');
        const shareBtn = document.getElementById('shareBtn');
        const shareModal = document.getElementById('shareModal');
        const closeShareModal = document.getElementById('closeShareModal');
        const closeShareBtn = document.getElementById('closeShareBtn');
        const sharePreview = document.getElementById('sharePreview');
        const downloadShareBtn = document.getElementById('downloadShareBtn');
        const successModal = document.getElementById('successModal');
        const closeSuccessModal = document.getElementById('closeSuccessModal');
        const errorModal = document.getElementById('errorModal');
        const errorMessage = document.getElementById('errorMessage');
        const closeErrorModal = document.getElementById('closeErrorModal');
        const debugPanel = document.getElementById('debugPanel');
        const showDebugBtn = document.getElementById('showDebugBtn');
        const toggleDebug = document.getElementById('toggleDebug');
        const clearLogs = document.getElementById('clearLogs');
        const logContainer = document.getElementById('logContainer');
        
        const settingsBtn = document.getElementById('settingsBtn');
        const tokenModal = document.getElementById('tokenModal');
        const closeTokenModal = document.getElementById('closeTokenModal');
        const tokenInput = document.getElementById('tokenInput');
        const toggleTokenVisibility = document.getElementById('toggleTokenVisibility');
        const saveTokenBtn = document.getElementById('saveTokenBtn');
        const fetchTokenBtn = document.getElementById('fetchTokenBtn');
        const tokenIframe = document.getElementById('tokenIframe');
        const eyeIcon = document.getElementById('eyeIcon');

        let papers = [];

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString('zh-CN');
            const colors = {
                info: 'text-blue-400',
                success: 'text-green-400',
                error: 'text-red-400',
                warn: 'text-yellow-400'
            };
            
            const logItem = document.createElement('div');
            logItem.className = `log-item py-1 px-2 rounded ${colors[type] || 'text-gray-400'}`;
            logItem.innerHTML = `<span class="text-gray-500">[${timestamp}]</span> ${escapeHtml(message)}`;
            
            logContainer.appendChild(logItem);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        showDebugBtn.addEventListener('click', () => {
            debugPanel.classList.remove('hidden');
            showDebugBtn.classList.add('hidden');
        });

        toggleDebug.addEventListener('click', () => {
            debugPanel.classList.add('hidden');
            showDebugBtn.classList.remove('hidden');
        });

        clearLogs.addEventListener('click', () => {
            logContainer.innerHTML = '';
            log('æ—¥å¿—å·²æ¸…ç©º', 'info');
        });

        settingsBtn.addEventListener('click', () => {
            tokenInput.value = token;
            tokenModal.classList.remove('hidden');
        });

        closeTokenModal.addEventListener('click', () => {
            tokenModal.classList.add('hidden');
        });

        tokenModal.addEventListener('click', (e) => {
            if (e.target === tokenModal) {
                tokenModal.classList.add('hidden');
            }
        });

        toggleTokenVisibility.addEventListener('click', () => {
            if (tokenInput.type === 'password') {
                tokenInput.type = 'text';
                eyeIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"></path>';
            } else {
                tokenInput.type = 'password';
                eyeIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>';
            }
        });

        saveTokenBtn.addEventListener('click', () => {
            const newToken = tokenInput.value.trim();
            if (!newToken) {
                alert('è¯·è¾“å…¥ Token');
                return;
            }
            if (!newToken.startsWith('github_pat_')) {
                alert('Token æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·è¾“å…¥æœ‰æ•ˆçš„ GitHub Token');
                return;
            }
            setToken(newToken);
            tokenModal.classList.add('hidden');
            log('Token å·²ä¿å­˜', 'success');
            fetchPapers();
        });

        fetchTokenBtn.addEventListener('click', async () => {
            fetchTokenBtn.disabled = true;
            fetchTokenBtn.innerHTML = `
                <div class="loading-spinner w-5 h-5 mr-2"></div>
                è·å–ä¸­...
            `;
            
            let fetchedToken = null;
            
            try {
                log('æ­£åœ¨ä»æœåŠ¡å™¨è·å– Token...', 'info');
                const response = await fetch('https://yourelnapi.rth1.xyz/');
                
                if (!response.ok) {
                    throw new Error('è·å–å¤±è´¥');
                }
                
                const data = await response.json();
                
                if (!data.github_pat || !data.github_pat.startsWith('github_pat_')) {
                    throw new Error('Token æ ¼å¼ä¸æ­£ç¡®');
                }
                
                fetchedToken = data.github_pat;
                tokenInput.value = fetchedToken;
                setToken(fetchedToken);
                tokenModal.classList.add('hidden');
                log('Token è·å–æˆåŠŸ!', 'success');
                fetchPapers();
                
            } catch (error) {
                log(`è·å– Token å¤±è´¥: ${error.message}`, 'error');
                
                tokenIframe.classList.remove('hidden');
                fetchTokenBtn.innerHTML = `
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                    </svg>
                    é‡æ–°è·å–
                `;
                alert('è‡ªåŠ¨è·å–å¤±è´¥ï¼Œè¯·åœ¨ä¸Šæ–¹é¡µé¢å¤åˆ¶ Token æˆ–ç‚¹å‡»"æ‰“å¼€é¡µé¢"å‰å¾€');
            } finally {
                fetchTokenBtn.disabled = false;
            }
        });

        async function fetchPapers() {
            log('å¼€å§‹è·å–å°çº¸æ¡...', 'info');
            try {
                const url = `https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/issues?state=open&labels=å°çº¸æ¡&sort=created&direction=desc&per_page=100`;
                
                log(`è¯·æ±‚ URL: ${url}`, 'info');
                
                const response = await fetch(url, {
                    headers: {
                        'Accept': 'application/vnd.github.v3+json',
                        'Authorization': `Bearer ${getToken()}`
                    }
                });

                log(`å“åº”çŠ¶æ€: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');

                if (!response.ok) {
                    const errorText = await response.text();
                    log(`é”™è¯¯å“åº”: ${errorText}`, 'error');
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const issues = await response.json();
                papers = issues;
                
                log(`æˆåŠŸè·å– ${papers.length} å¼ å°çº¸æ¡`, 'success');
                
                const countText = papers.length === 0 ? 'æš‚æ— å°çº¸æ¡' : `${papers.length} å¼ å°çº¸æ¡`;
                paperCount.textContent = countText;
                
                loadingState.classList.add('hidden');
                
                if (papers.length === 0) {
                    emptyState.classList.remove('hidden');
                } else {
                    papersGrid.classList.remove('hidden');
                    renderPapers();
                }
            } catch (error) {
                log(`è·å–å¤±è´¥: ${error.message}`, 'error');
                console.error('è·å–å°çº¸æ¡å¤±è´¥:', error);
                loadingState.classList.add('hidden');
                emptyState.classList.remove('hidden');
            }
        }

        function renderPapers() {
            papersContainer.innerHTML = '';
            
            papers.forEach((paper, index) => {
                const card = document.createElement('div');
                card.className = 'paper-card rounded-2xl p-5 card-enter';
                card.style.animationDelay = `${index * 0.1}s`;
                
                const date = new Date(paper.created_at);
                const formattedDate = date.toLocaleDateString('zh-CN', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                let content = paper.body || 'ï¼ˆæ— å†…å®¹ï¼‰';
                let author = 'åŒ¿å';
                
                if (content.includes('ğŸ‘¤ å‘å¸ƒè€…:')) {
                    const parts = content.split('ğŸ‘¤ å‘å¸ƒè€…:');
                    content = parts[0].trim();
                    author = parts[1] ? parts[1].trim() : 'åŒ¿å';
                }
                
                card.innerHTML = `
                    <div class="flex items-center gap-2 mb-3">
                        <div class="w-8 h-8 bg-yellow-400 rounded-full flex items-center justify-center text-gray-800 font-bold text-sm">
                            ${author.charAt(0)}
                        </div>
                        <span class="text-gray-600 font-medium">${escapeHtml(author)}</span>
                    </div>
                    <p class="text-gray-700 text-base leading-relaxed mb-4 whitespace-pre-wrap break-words">${escapeHtml(content)}</p>
                    <div class="flex justify-between items-center text-sm text-gray-400">
                        <span>${formattedDate}</span>
                        <a href="${paper.html_url}" target="_blank" class="hover:text-amber-600 transition-colors">
                            #${paper.number}
                        </a>
                    </div>
                `;
                
                papersContainer.appendChild(card);
            });
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        writeBtn.addEventListener('click', () => {
            if (!checkToken()) return;
            paperAuthor.value = getUsername();
            writeModal.classList.remove('hidden');
            paperContent.focus();
        });

        closeWriteModal.addEventListener('click', () => {
            writeModal.classList.add('hidden');
        });

        writeModal.addEventListener('click', (e) => {
            if (e.target === writeModal) {
                writeModal.classList.add('hidden');
            }
        });

        paperContent.addEventListener('input', () => {
            const length = paperContent.value.length;
            charCount.textContent = `${length}/500`;
            
            if (length > 450) {
                charCount.classList.add('text-orange-400');
            } else {
                charCount.classList.remove('text-orange-400');
            }
        });

        let imageBase64 = null;

        paperImage.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            
            if (file.size > 5 * 1024 * 1024) {
                alert('å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡ 5MB');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = (event) => {
                imageBase64 = event.target.result;
                previewImg.src = imageBase64;
                imagePreview.classList.remove('hidden');
                clearImageBtn.classList.remove('hidden');
            };
            reader.readAsDataURL(file);
        });

        clearImageBtn.addEventListener('click', () => {
            paperImage.value = '';
            imageBase64 = null;
            imagePreview.classList.add('hidden');
            clearImageBtn.classList.add('hidden');
        });

        shareBtn.addEventListener('click', () => {
            const content = paperContent.value.trim();
            if (!content) {
                alert('è¯·å…ˆè¾“å…¥å†…å®¹');
                return;
            }
            generateShareImage();
        });

        closeShareModal.addEventListener('click', () => {
            shareModal.classList.add('hidden');
        });

        closeShareBtn.addEventListener('click', () => {
            shareModal.classList.add('hidden');
        });

        shareModal.addEventListener('click', (e) => {
            if (e.target === shareModal) {
                shareModal.classList.add('hidden');
            }
        });

        downloadShareBtn.addEventListener('click', () => {
            const canvas = sharePreview.querySelector('canvas');
            if (canvas) {
                const link = document.createElement('a');
                link.download = `å°çº¸æ¡-${Date.now()}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            }
        });

        function generateShareImage() {
            const author = paperAuthor.value.trim() || 'åŒ¿å';
            const content = paperContent.value.trim();
            
            const width = 600;
            const padding = 40;
            const contentWidth = width - padding * 2;
            
            const tempDiv = document.createElement('div');
            tempDiv.style.cssText = `
                position: absolute;
                left: -9999px;
                width: ${width}px;
                font-family: 'Noto Sans SC', sans-serif;
                background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
                padding: ${padding}px;
                color: #333;
                font-size: 18px;
                line-height: 1.8;
            `;
            
            const bgGradient = 'background: radial-gradient(circle at 20% 80%, rgba(255, 223, 112, 0.15) 0%, transparent 50%), radial-gradient(circle at 80% 20%, rgba(255, 223, 112, 0.1) 0%, transparent 50%), linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);';
            
            let html = `
                <div style="${bgGradient} min-height: 400px; padding: 30px; border-radius: 24px; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
                    <div style="text-align: center; margin-bottom: 24px;">
                        <h1 style="background: linear-gradient(135deg, #ffdf70 0%, #ffd43b 50%, #ffdf70 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-size: 28px; font-weight: bold; margin: 0;">å°çº¸æ¡å¢™</h1>
                        <p style="color: #888; font-size: 14px; margin: 8px 0 0;">Paper Wall</p>
                    </div>
                    
                    <div style="background: linear-gradient(145deg, #fff9e6, #fff5d6); border-radius: 16px; padding: 24px; box-shadow: 0 10px 40px rgba(255, 223, 112, 0.2);">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                            <div style="width: 36px; height: 36px; background: linear-gradient(135deg, #ffdf70, #ffd43b); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #333; font-size: 16px;">${author.charAt(0)}</div>
                            <span style="color: #666; font-weight: 500;">${escapeHtml(author)}</span>
                        </div>
                        <p style="color: #333; font-size: 18px; line-height: 1.8; white-space: pre-wrap; word-wrap: break-word; margin: 0;">${escapeHtml(content)}</p>
                        ${imageBase64 ? `<img src="${imageBase64}" style="max-width: 100%; border-radius: 12px; margin-top: 16px; max-height: 200px; object-fit: cover;">` : ''}
                    </div>
                    
                    <div style="text-align: center; margin-top: 24px;">
                        <p style="color: rgba(255,255,255,0.5); font-size: 12px;">ğŸ“ æ¥è‡ª å°çº¸æ¡å¢™ | paperwall.site</p>
                    </div>
                </div>
            `;
            
            tempDiv.innerHTML = html;
            document.body.appendChild(tempDiv);
            
            html2canvas(tempDiv.firstElementChild, {
                scale: 2,
                useCORS: true,
                backgroundColor: null
            }).then(canvas => {
                document.body.removeChild(tempDiv);
                sharePreview.innerHTML = '';
                canvas.style.width = '100%';
                canvas.style.borderRadius = '16px';
                sharePreview.appendChild(canvas);
                shareModal.classList.remove('hidden');
            }).catch(err => {
                document.body.removeChild(tempDiv);
                alert('ç”Ÿæˆå›¾ç‰‡å¤±è´¥: ' + err.message);
            });
        }

        publishBtn.addEventListener('click', async () => {
            const content = paperContent.value.trim();
            
            if (!content) {
                shakeButton();
                log('å†…å®¹ä¸ºç©ºï¼Œæ— æ³•å‘å¸ƒ', 'warn');
                return;
            }

            if (content.length > 500) {
                showError('å°çº¸æ¡å†…å®¹ä¸èƒ½è¶…è¿‡500å­—');
                log('å†…å®¹è¶…è¿‡500å­—é™åˆ¶', 'warn');
                return;
            }

            setLoading(true);
            log('å¼€å§‹å‘å¸ƒå°çº¸æ¡...', 'info');

            try {
                await createGitHubIssue(content);
                writeModal.classList.add('hidden');
                showSuccessAnimation();
                paperContent.value = '';
                charCount.textContent = '0/500';
                paperImage.value = '';
                imageBase64 = null;
                imagePreview.classList.add('hidden');
                clearImageBtn.classList.add('hidden');
                log('å°çº¸æ¡å‘å¸ƒæˆåŠŸ!', 'success');
                
                setTimeout(() => {
                    fetchPapers();
                }, 1000);
            } catch (error) {
                console.error('å‘å¸ƒå¤±è´¥:', error);
                log(`å‘å¸ƒå¤±è´¥: ${error.message}`, 'error');
                showError(error.message || 'å‘å¸ƒå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            } finally {
                setLoading(false);
            }
        });

        async function createGitHubIssue(content) {
            const url = `https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/issues`;
            
            const author = paperAuthor.value.trim() || 'åŒ¿å';
            setUsername(author);
            
            let bodyContent = content;
            if (imageBase64) {
                bodyContent += `\n\n---\nğŸ“· å›¾ç‰‡:\n${imageBase64}`;
            }
            
            const body = {
                title: `å°çº¸æ¡ - ${author} - ${new Date().toLocaleString('zh-CN')}`,
                body: `${bodyContent}\n\n---\nğŸ‘¤ å‘å¸ƒè€…: ${author}`,
                labels: ['å°çº¸æ¡']
            };
            
            log(`è¯·æ±‚ URL: ${url}`, 'info');
            log(`è¯·æ±‚ä½“: ${JSON.stringify(body)}`, 'info');
            
            const response = await fetch(url, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${getToken()}`,
                    'Accept': 'application/vnd.github+json',
                    'Content-Type': 'application/json',
                    'X-GitHub-Api-Version': '2022-11-28'
                },
                body: JSON.stringify(body)
            });

            const responseText = await response.text();
            log(`å“åº”çŠ¶æ€: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');
            
            if (!response.ok) {
                let errorMsg = 'å‘å¸ƒå¤±è´¥';
                try {
                    const errorData = JSON.parse(responseText);
                    errorMsg = errorData.message || errorMsg;
                    log(`é”™è¯¯è¯¦æƒ…: ${responseText}`, 'error');
                    
                    if (errorData.message && errorData.message.includes('Bad credentials')) {
                        errorMsg = 'Token æ— æ•ˆæˆ–å·²è¿‡æœŸ';
                    } else if (errorData.message && errorData.message.includes('rate limit')) {
                        errorMsg = 'API è¯·æ±‚æ¬¡æ•°å·²è¾¾ä¸Šé™';
                    } else if (errorData.message && errorData.message.includes('Not Found')) {
                        errorMsg = 'ä»“åº“ä¸å­˜åœ¨æˆ–æ— æƒé™';
                    }
                } catch (e) {
                    errorMsg = `HTTP ${response.status}: ${response.statusText}`;
                    log(`è§£æé”™è¯¯å“åº”å¤±è´¥: ${e.message}`, 'error');
                }
                throw new Error(errorMsg);
            }

            return JSON.parse(responseText);
        }

        function setLoading(loading) {
            if (loading) {
                publishBtn.disabled = true;
                publishBtn.innerHTML = `
                    <div class="loading-spinner w-5 h-5 mr-2"></div>
                    <span>å‘å¸ƒä¸­...</span>
                `;
            } else {
                publishBtn.disabled = false;
                publishBtn.innerHTML = `
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                    </svg>
                    å‘å¸ƒå°çº¸æ¡
                `;
            }
        }

        function showSuccessAnimation() {
            successModal.classList.remove('hidden');
            createParticles();
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorModal.classList.remove('hidden');
        }

        function createParticles() {
            const colors = ['#ffdf70', '#ffd43b', '#fff5d6', '#fff9e6'];
            
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.left = `${Math.random() * 100}%`;
                    particle.style.top = `${Math.random() * 100}%`;
                    particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                    particle.style.setProperty('--tx', `${(Math.random() - 0.5) * 200}px`);
                    particle.style.setProperty('--ty', `${(Math.random() - 0.5) * 200}px`);
                    particle.style.width = `${Math.random() * 8 + 4}px`;
                    particle.style.height = particle.style.width;
                    
                    document.body.appendChild(particle);
                    
                    setTimeout(() => {
                        particle.remove();
                    }, 1000);
                }, i * 30);
            }
        }

        function shakeButton() {
            publishBtn.style.animation = 'none';
            publishBtn.offsetHeight;
            publishBtn.style.animation = 'shake 0.5s ease-in-out';
            
            if (!document.getElementById('shake-style')) {
                const style = document.createElement('style');
                style.id = 'shake-style';
                style.textContent = `
                    @keyframes shake {
                        0%, 100% { transform: translateX(0); }
                        10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
                        20%, 40%, 60%, 80% { transform: translateX(5px); }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        closeSuccessModal.addEventListener('click', () => {
            successModal.classList.add('hidden');
        });

        closeErrorModal.addEventListener('click', () => {
            errorModal.classList.add('hidden');
        });

        successModal.addEventListener('click', (e) => {
            if (e.target === successModal) {
                successModal.classList.add('hidden');
            }
        });

        errorModal.addEventListener('click', (e) => {
            if (e.target === errorModal) {
                errorModal.classList.add('hidden');
            }
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                if (!writeModal.classList.contains('hidden')) {
                    writeModal.classList.add('hidden');
                }
                if (!successModal.classList.contains('hidden')) {
                    successModal.classList.add('hidden');
                }
                if (!errorModal.classList.contains('hidden')) {
                    errorModal.classList.add('hidden');
                }
            }
        });

        if (checkToken()) {
            fetchPapers();
        }
    </script>
</body>
</html>